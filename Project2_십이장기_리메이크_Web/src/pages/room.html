<!DOCTYPE html>
<html lang="ko">

<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 십이장기 메인 </title>
    <link href="../styles/room.css" rel="stylesheet"> </link>
    <link
      rel="shortcut icon"
      href="/assets/favicon/favicon.png?v=2"
      type="image/x-icon"
    />
<style>

</style>
</head> 

<body>
<div class="container">
  <div class="card">

    <!-- 탭 -->
    <div class="tabs">
      <button class="tab active" data-tab="create">방 만들기</button>
      <button class="tab" data-tab="join">방 입장하기</button>
    </div>

    <!-- 이름 -->
    <input
      type="text"
      id="name"
      class="input main"
      placeholder="이름을 입력해주세요"
    >

    <!-- 방 생성 -->
    <div class="tab-content active" id="create">

      <div class="section">
        <label>방 ID</label>
        <div class="id-row">
          <span id="IDshow" class="room-id"></span>
          <button class="icon-btn" onclick="get_ID()">⟳</button>
        </div>
      </div>

      <div class="section">
        <label>비밀번호 설정</label>
        <input type="text" id="password" class="input" placeholder="비밀번호 없음">
      </div>

      <div class="section">
        <label>진영 선택</label>
        <div class="radio-group">
          <label><input type="radio" id="random" name="color" checked> 랜덤</label>
          <label><input type="radio" id="green" name="color"> 녹색</label>
          <label><input type="radio" id="red" name="color"> 적색</label>
        </div>
      </div>

      <div class="section">
        <label>시간 (초)</label>
        <input type="text" id="time" class="input" value="30">
      </div>

      <button id="create_room" class="primary-btn">방 만들기</button>
    </div>

    <!-- 방 입장 -->
    <div class="tab-content" id="join">

      <div class="section">
        <label>방 ID 입력</label>
        <input type="text" id="join_ID" class="input">
      </div>

      <div class="section">
        <label>비밀번호 입력</label>
        <input type="text" id="join_password" class="input">
      </div>

      <button id="join_room" class="primary-btn">방 참여하기</button>
    </div>

  </div>
</div>

<script>
    const tabs = document.querySelectorAll(".tab");
    const contents = document.querySelectorAll(".tab-content");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));

        tab.classList.add("active");
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });

const URL = location.origin + "/";


const IDshow = document.getElementById("IDshow");

let ID;

while (true){
    ID = Math.floor(10000*Math.random());
    if (ID < 1000){
        continue;
    } else {
        break;
    }
}
IDshow.innerText = ID;

function get_ID(){
    while (true){
        ID = Math.floor(10000*Math.random());
        if (ID < 1000){
            continue;
        } else {
            break;
        }
    }
    IDshow.innerText = ID;
    return;
    }



//console.log(name, random, green, red, time, password, color);


const create_room = document.getElementById("create_room");
const join_room = document.getElementById("join_room");



// 서버 요청
let send_name;

create_room.addEventListener("click", (e) => {


const name = document.getElementById("name").value;
const random = document.getElementById("random").checked;
const green = document.getElementById("green").checked;
const red = document.getElementById("red").checked;
const time = document.getElementById("time").value;
const password = document.getElementById("password").value;



if (name == ""){
    send_name = '이름없음';
}else{
    send_name = name;
}


function radio(){
    if (random === true){
        return 'random';
    } else if (green === true){
        return 'green';
    }else if(red === true){
        return 'red';
    }
}

let color = radio();


fetch("/", {
    method: "POST",                     // POST 방식
    headers: {
    "Content-Type": "application/json" // 보낼 데이터 형식
    },
    body: JSON.stringify({              // 실제로 보낼 데이터
    host : true,
    name: send_name,
    color: color,
    time: time,
    ID: ID,
    password: password
    })
})
.then(res => res.json())              // 서버 응답(JSON) 받기
.then(data => {
    if(data.type === 'ok'){
        window.location.href = URL+ID;
    }else if(data.type === 'ID_error'){
        alert('ID를 다시 설정해주세요');
    }
})
.catch(err => console.error("에러:", err))


});





join_room.addEventListener('click', (e) => {

const name = document.getElementById("name").value;
const join_ID = document.getElementById("join_ID").value;
const join_password = document.getElementById("join_password").value;


if (name == ""){
    send_name = '이름없음';
}else{
    send_name = name;
}


fetch("/", {
    method : 'POST',
    headers : {
        "Content-Type" : "application/json"
    },
    body : JSON.stringify({
        host : false,
        name : send_name,
        ID : join_ID,
        password : join_password
    })
})
.then(res => res.json())
.then(data => {
    if(data.type === 'ok'){
        window.location.href = URL+join_ID;
    }else if(data.type === 'password_error'){
        alert('비밀번호가 틀렸습니다.');
    }else if(data.type === 'ID_error'){
        alert('ID를 다시 설정해주세요.');
    }else if(data.type === 'room_error'){
        alert('방이 존재하지 않습니다.')
    }
})
.catch(err => console.error("에러:", err));





})

</script>

</body>

</html>

